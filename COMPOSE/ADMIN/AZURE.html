<!--
title: AZURE
description: 
published: true
date: 2023-09-18T12:40:05.958Z
tags: 
editor: ckeditor
dateCreated: 2023-09-18T12:40:04.899Z
-->

<p><a href="https://learn.microsoft.com/en-us/azure/app-service/tutorial-multi-container-app">https://learn.microsoft.com/en-us/azure/app-service/tutorial-multi-container-app</a></p>
<p>&nbsp;</p>
<p>Docker Compose options</p>
<p>The following lists show supported and unsupported Docker Compose configuration options:</p>
<p>Supported options</p>
<ul>
  <li>command</li>
  <li>entrypoint</li>
  <li>environment</li>
  <li>image</li>
  <li>ports</li>
  <li>restart</li>
  <li>services</li>
  <li>volumes (<a href="https://learn.microsoft.com/en-us/azure/app-service/configure-connect-to-azure-storage?tabs=portal&amp;pivots=container-linux#limitations">mapping to Azure Storage is unsupported</a>)</li>
</ul>
<p>Unsupported options</p>
<ul>
  <li>build (not allowed)</li>
  <li><a href="https://learn.microsoft.com/en-us/azure/app-service/faq-app-service-linux#how-do-i-use-depends-on-">depends_on</a>&nbsp;(ignored)</li>
  <li>networks (ignored)</li>
  <li>secrets (ignored)</li>
  <li>ports other than 80 and 8080 (ignored)</li>
  <li>default environment variables like&nbsp;$variable and ${variable}&nbsp;unlike in docker</li>
</ul>
<p>Syntax Limitations</p>
<ul>
  <li>"version x.x" always needs to be the first YAML statement in the file</li>
  <li>ports section must use quoted numbers</li>
  <li>image &gt; volume section must be quoted and cannot have permissions definitions</li>
  <li>volumes section must not have an empty curly brace after the volume name</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>We're working to add more Multi-container web app samples.&nbsp; To get you started quickly, please feel free to copy the samples provided in this blog post, or download more from&nbsp;<a href="https://github.com/yiliaomsft">Github</a>.</p>
<p><strong>Scaling Multi-container Web App</strong></p>
<p>Customer can scale up and / or out a stateless multi-container app just as any web apps hosted on App Service, using the same scaling features provided by App Service. If you would like to use a database in container for dev/testing purposes in a single-host app, please make sure to use the persisted shared storage to store your database files, so the database files can be persisted during app restarts. First, you should enable the App Service shared storage following the instructions at&nbsp;<a href="https://review.docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-faq">here</a>. Then, you should mount the shared storage to a directory within the Docker container where you store the database files, a MySQL example in docker-compose.yml:</p>
<p><i>services: mysql: image: mysql:5.7 volumes: - ${WEBAPP_STORAGE_HOME}/site:[/path/in/container/where/mysqlfiles/needs/to/be/mounted]</i></p>
<p>If you would like to scale out a multi-container app to multiple hosts in an App Service plan and use the app for production purpose, we strongly recommend you use Azure Database services instead of putting the database in a container. For example, for a WordPress app you can move the database to an Azure Database for MySQL.&nbsp; To do that, please follow the following steps:</p>
<ul>
  <li>Create a MySQL instance on Azure Database for MySQL servers. This can be easily done through Azure portal or CLI.&nbsp; Make sure to configure MySQL server for SSL following the instructions at&nbsp; <a href="https://docs.microsoft.com/en-us/azure/mysql/howto-configure-ssl">https://docs.microsoft.com/en-us/azure/mysql/howto-configure-ssl</a>, and also make sure to enable client access to MySQL server by configuring MySQL firewall rules:&nbsp;&nbsp; <a href="https://docs.microsoft.com/en-us/azure/mysql/concepts-firewall-rules">https://docs.microsoft.com/en-us/azure/mysql/concepts-firewall-rules</a>.</li>
  <li>Modify your docker-compose.yml to use Azure MySQL instead of local MySQL server, for example, if you have a WordPress app connect to a MySQL database, you can pass the following environment variables in&nbsp;docker-compose.yml:</li>
</ul>
<p><i>WORDPRESS_DB_HOST: [mysql server name].mysql.database.azure.com&nbsp;WORDPRESS_DB_USER: [db user name]@[mysql server name]&nbsp;WORDPRESS_DB_PASSWORD: [database password]</i></p>
<ul>
  <li>Test the configuration locally with docker-compose up before you push it to App Service.</li>
</ul>
<p><strong>Limitations in Public Preview</strong></p>
<p>We wanted to put this feature out as soon as possible so customer can validate and provide more feedbacks during Preview. There are certain limitations in this Public Preview release. We support Docker-Compose and Kubernetes format to describe a multi-container app, but we don’t support all their configuration objects during Public Preview. Our goal is to support any configuration objects that are meaningful to App Service during this release. The supported objects and limitations are as follows:</p>
<p><strong>Docker-Compose</strong></p>
<p>Supported configuration in Public Preview:&nbsp;<strong>services</strong>&nbsp;A service definition contains configuration that is applied to each container started for that service, much like passing command-line parameters to docker container create.&nbsp;<strong>image</strong>&nbsp;Specify the image to start the container from. Can either be a repository/tag or a partial image ID.&nbsp;<strong>ports</strong>&nbsp;Expose ports by mapping ports in the HOST:CONTAINER pattern, recommend explicitly specifying your port mapping as string. App Service specific, we would only expose one service port to external, we would identify a single service port to expose to external based on the HOST port provided for each service, we're looking for port 80 or port 8080.&nbsp;<strong>environment</strong>&nbsp;Add environment variables. You can use an array as input. The dictionary format is not supported in current release, we will add support for dictionary format in next release.</p>
<p><i>environment:&nbsp; #supported RACK_ENV: development SHOW: 'true' SESSION_SECRET: environment:&nbsp; #not supported - RACK_ENV=development - SHOW=true - SESSION_SECRET</i></p>
<p><strong>volumes</strong>&nbsp;Mount host paths or named volumes, specified as sub-options to a service. We support both persisted volume and non-persisted volume. To use the persisted volume, please enable the shared storage by set WEBSITES_ENABLE_APP_SERVICE_STORAGE=TRUE.&nbsp; You can reference the shared storage using ${WEBAPP_STORAGE_HOME}. For example, you can mount the shared storage to /tmp in the container:</p>
<p><i>volumes: - ${WEBAPP_STORAGE_HOME}/site/wwwroot:/tmp</i></p>
<p><strong>command</strong>&nbsp;Override the default command. Currently we support the collection format, for example: command: ["bundle", "exec", "thin", "-p", "3000"]. We will add support for a single string after public preview.&nbsp;<strong>entrypoint</strong>&nbsp;Override the default entrypoint.&nbsp;<strong>restart</strong>&nbsp;“no” is the default restart policy, and it does not restart a container under any circumstance. When “always” is specified, the container always restarts. More info at&nbsp;<a href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/#restart</a>. Configuration not supported in Public Preview: (besides the list below, any other Docker-Compose syntax not explicitly called out in the “Supported Configuration” section will not be supported in Public Preview)&nbsp;<strong>build</strong>&nbsp;Configuration options that are applied at build time. We don’t support “build” image locally as we need an explicit image to start the container with.&nbsp;<strong>depends_on</strong>&nbsp;Express dependency between services. we don’t currently support “depends_on” to specify the dependencies among containers, but we plan to support this shortly after Public Preview.&nbsp;<strong>networks</strong>&nbsp;Networks to join. We don’t support additional “networks” as we run all containers on one Bridge network.&nbsp;<strong>secrets</strong>&nbsp;Grant access to secrets on a per-service basis using the per-service secrets configuration. We don’t currently support it, but we plan to support this shortly after Public Preview.</p>
