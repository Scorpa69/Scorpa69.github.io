<!--
title: BONNES PRATIQUES
description: 
published: true
date: 2023-09-28T12:57:26.612Z
tags: 
editor: ckeditor
dateCreated: 2023-09-18T12:36:14.804Z
-->

<h1><strong>Ajoutez un utilisateur «&nbsp;docker&nbsp;» (a tester)</strong></h1>
<p>De base, lorsque vous installez Docker, seul l’utilisateur «&nbsp;root&nbsp;» aura accès à Docker. Par conséquent, Docker aura accès à tous les fichiers et dossiers de vos disques durs.</p>
<p>Exécutez le script suivant pour restreindre Docker à un utilisateur :</p>
<pre><code class="language-plaintext">groupadd -g 500000 dockremap &amp;&amp; 
groupadd -g 501000 dockremap-user &amp;&amp; 
useradd -u 500000 -g dockremap -s /bin/false dockremap &amp;&amp; 
useradd -u 501000 -g dockremap-user -s /bin/false dockremap-user

echo "dockremap:500000:65536" &gt;&gt; /etc/subuid &amp;&amp; 
echo "dockremap:500000:65536" &gt;&gt;/etc/subgid

echo "
  {
   \"userns-remap\": \"default\"
  }
" &gt; /etc/docker/daemon.json

systemctl daemon-reload &amp;&amp; systemctl restart docker

</code></pre>
<p>Ce script va créer l’utilisateur et le groupe dockremap que Docker est prêt à utiliser.<br>Cet utilisateur n’aura aussi pas de shell (/bin/false), pour limiter ce qu’il est autorisé à faire.</p>
<h1>Docker en production</h1>
<p>Docker est un outil très utile pour les développeurs qui souhaitent créer des applications qui peuvent être facilement déployées dans différents environnements. Cependant, lorsque vous utilisez Docker en production, il y a plusieurs considérations importantes à prendre en compte pour garantir la stabilité et la sécurité de votre système.</p>
<p>Voici quelques bonnes pratiques à suivre pour utiliser Docker en production :</p>
<p>1. Utilisez des images fiables : Assurez-vous d'utiliser des images officielles ou des images de confiance provenant de sources fiables. Évitez de télécharger des images provenant de sources inconnues ou douteuses.</p>
<p>2. Limitez les privilèges : Assurez-vous que les conteneurs Docker s'exécutent avec les privilèges les plus bas possibles pour réduire les risques de sécurité.</p>
<p>3. Évitez les volumes partagés : Évitez de partager des volumes entre les conteneurs Docker pour éviter les conflits et les problèmes de sécurité.</p>
<p>4. Mettez à jour régulièrement : Assurez-vous de mettre régulièrement à jour les images Docker et les conteneurs pour bénéficier des dernières mises à jour de sécurité et des correctifs de bugs.</p>
<p>5. Utilisez des outils de surveillance : Utilisez des outils de surveillance pour suivre les performances des conteneurs Docker et détecter rapidement les problèmes.</p>
<p>6. Sauvegardez régulièrement : Assurez-vous de sauvegarder régulièrement les données de vos conteneurs Docker pour éviter la perte de données en cas de défaillance du système.</p>
<p>En suivant ces bonnes pratiques, vous pouvez utiliser Docker en production de manière sûre et efficace.</p>
<h1>Mode rootless</h1>
<pre><code class="language-plaintext">En root:
apt install fuse-overlayfs uidmap -y
systemctl disable --now docker.service docker.socket
reboot
En user:
dockerd-rootless-setuptool.sh install
export PATH=/usr/bin:$PATH
export DOCKER_HOST=unix:///run/user/1000/docker.sock
FIN
Pour desintaller en User :
dockerd-rootless-setuptool.sh uninstall
Démarrage du service docker :
systemctl --user start docker
Démarrage au reboot:
systemctl --user enable docker
en root : loginctl enable-linger mboa
Si erreur : 
ERROR: Couldn't connect to Docker daemon at http+docker://localhost - is it running?
If it's at a non-standard location, specify the URL with the DOCKER_HOST environment variable.

export DOCKER_HOST=unix:///run/user/1000/docker.sock

</code></pre>
<p>&nbsp;</p>
<figure class="image"><img src="/2023-03-15_16_05_28-experimenting_with_rootless_docker___by_tõnis_tiigi___medium_–_brave.png"></figure>
