<!--
title: SCRIPT
description: 
published: true
date: 2023-09-18T12:39:02.927Z
tags: 
editor: ckeditor
dateCreated: 2023-09-18T12:39:01.462Z
-->

<h1>SAUVEGARDE FICHIER AVCE RENOMMAGE ET RETENTION : !!! Attention pas de chemin r√©seau pour la commande forfiles !!!!</h1>
<p>@echo off</p>
<p>set host=SIDFDKS01</p>
<p>set pathfile=f:\Sauvegarde\SQL\MoveBackupNAS\DKS_PROD.bak</p>
<p>set ret=7</p>
<p>set date_time=%date:~6,4%-%date:~3,2%-%date:~0,2%_%time:~0,2%%time:~3,2%%time:~6,2%</p>
<p>net use n: <a href="file://nidfnas01/movebackup">\\nidfnas01\movebackup</a> /user:nidfnas01\mvbckp R6pf_GM5*T_NYCUH /persistent:no</p>
<p>copy %pathfile% n:\%host%\DKS_PROD_%date_time%.bak</p>
<p>if %errorlevel%&nbsp; equ 0 (echo backupOK &gt;&gt; n:\%host%\backup_du_%date_time%_OK.txt) else (echo backupKO &gt;&gt; n:\%host%\backup_du_%date_time%_KO_erreur_%errorlevel%)</p>
<p>forfiles /P n:\%host% /M *.* /C "cmd /c del @path" /D -%ret%</p>
<p>net use n: /delete</p>
<p>exit</p>
<p>&nbsp;</p>
<p>TEST SCRIPT CI-DESSUS :</p>
<p>net use n: <a href="file://nidfnas01/movebackup">\\nidfnas01\movebackup</a> /user:nidfnas01\mvbckp R6pf_GM5*T_NYCUH /persistent:no</p>
<p>&nbsp;</p>
<p>copy f:\Sauvegarde\SQL\MoveBackupNAS\DKS_PROD.bak <a href="file://nidfnas01/movebackup/SIDFDKS01/DKS_PROD_05072021_1432.bak">\\nidfnas01\movebackup\SIDFDKS01\DKS_PROD_05072021_1432.bak</a></p>
<p>&nbsp;</p>
<p>if %errorlevel%&nbsp; equ 0 (echo backupOK &gt;&gt; <a href="file://nidfnas01/movebackup/SIDFDKS01/backup_du_05072021_ok.txt">\\nidfnas01\movebackup\SIDFDKS01\backup_du_05072021_ok.txt</a>) else (echo backupKO &gt;&gt; <a href="file://nidfnas01/movebackup/SIDFDKS01/backup_du_05072021_KO_erreur_%25errorlevel%25">\\nidfnas01\movebackup\SIDFDKS01\backup_du_05072021_KO_erreur_%errorlevel%</a>)</p>
<p>&nbsp;</p>
<p>forfiles /P n:\SIDFDKS01 /M *.* /C "cmd /c del @path" /D -7</p>
<p>&nbsp;</p>
<p>net use n: /delete</p>
<p>&nbsp;</p>
<p>ATTENDRE QUE LA COMMANDE PRECEDENTE SOIT FINI:</p>
<p>PING -n 11 127.0.0.1&gt;nul</p>
