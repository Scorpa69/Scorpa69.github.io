<!--
title: RDS
description: 
published: true
date: 2023-09-18T12:38:49.567Z
tags: rds
editor: ckeditor
dateCreated: 2023-09-18T12:38:48.365Z
-->

<p>Supprimer un profile utilisateur sur plusieurs serveurs (cela fonctionne aussi en dehors de RDS) : La commande ci-dessous ne fonctionne pas sur notre ferme RDP Farm1 =&gt; connection winrm impossible, le script fonctionne !!!!!</p>
<p>Get-CimInstance -ComputerName VIDFRDP01,VIDFRDP02,VIDFRDP03,VIDFRDP04,VIDFRDP05,VIDFRDP06 -Class Win32_UserProfile | Where-Object { $_.LocalPath.split('\')[-1] -eq 'CEO' } | Remove-CimInstance</p>
<p>&nbsp;</p>
<p>Ou voir le script PS1 dans C:\Users\A09\Nextcloud\4-INFOS\Comande&amp;Script\PS\Delete profile with GUI v2.ps1 pensez à changer les noms des serveurs</p>
<p>&nbsp;</p>
<p>Lister le comptes roaming d'un user sur plusieurs serveurs:</p>
<p>Invoke-Command -ComputerName VIDFRDP01,VIDFRDP02,VIDFRDP03,VIDFRDP04,VIDFRDP05,VIDFRDP06 -ScriptBlock {Get-CimInstance -Class Win32_UserProfile | Where-Object {$_.LocalPath.split('\')[-1] -eq 'CEO'} | select roaming*}</p>
<p>&nbsp;</p>
<p>Connaitre le statut du change logon:</p>
<p>change logon /query</p>
<p>&nbsp;</p>
<p>Désactiver les connexions user mais autorise les reconnexions de session existante jusqu'au prochain redemarrage :</p>
<p>change logon /drainuntilrestart</p>
<p>&nbsp;</p>
<p>Désactiver les connexions user et empêche les reconnexions existantes :</p>
<p>change logon /disable</p>
<p>&nbsp;</p>
<p>Activer les connexions user :</p>
<p>change logon /enable</p>
<p>&nbsp;</p>
<p>Désactiver les connexions user mais autorise les reconnexions de session existante :</p>
<p>change logon /drain</p>
