<!--
title: SSH
description: 
published: true
date: 2024-01-23T11:20:44.140Z
tags: ssh
editor: ckeditor
dateCreated: 2023-09-18T12:39:05.708Z
-->

<h1>SSH TUNNELING</h1>
<p>Vérifier que sur la machine ssh distante (server ssh) le fichier de config (/etc/ssh/sshd_config contienne ces deux options</p>
<p>AllowTcpForwarding yes</p>
<p>GatewayPorts yes&nbsp;</p>
<p>Ensuite depuis un powershell:</p>
<p>ssh -L localhost:21 localhost:21 liely1953@20.86.96.236</p>
<p>ssh -L localhost:21 localhost:21 tunnel@updates.compagnons-arcadie.com</p>
<p>ssh -L [LOCAL_IP:]LOCAL_PORT:DESTINATION:DESTINATION_PORT [USER@]SSH_SERVER</p>
<h1>Installer SSH pour PS:</h1>
<p>Get-WindowsCapability -Online | Where-Object Name -like 'OpenSSH*'</p>
<p>Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0</p>
<p>Get-Service ssh-agent | Set-Service -StartupType Automatic</p>
<p>Start-Service ssh-agent</p>
<h1>Connexion en precisant le chemin de la clé privée depuis powershell :</h1>
<p>ssh admin@52.47.97.170 -i C:\users\mbo\.ssh\aws</p>
<h1>Extraire la clé privé:</h1>
<p>ssh-keygen -y -f C:\Users\A09\Nextcloud\1-INFRA_AC\Projet\LEC\prodfrc-ftpweb-vm01_key.pem &gt; C:\Users\A09\Nextcloud\1-INFRA_AC\Projet\LEC\prodfrc-ftpweb-vm01_key.pub</p>
<h1>Génération de paires de clés:</h1>
<pre><code class="language-plaintext">ssh-keygen -t Ed25519 -f c:\users\a09\desktop\ftplec</code></pre>
<pre><code class="language-plaintext">ssh-keygen -b 4096 -t RSA -f c:\users\a09\desktop\majlecadmin</code></pre>
<pre><code class="language-plaintext">ssh-keygen -b 4096 -t RSA -f A:\A09_ID\A09_ID</code></pre>
<h1>Copier la clé public dans les clé authorisées de la machine souhaité :&nbsp;</h1>
<pre><code class="language-plaintext">type 'C:\Users\A09\OneDrive - Absys Cyborg\A09\1-INFRA_AC\A09_ID.pub' | ssh mboa@hostname 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys' </code></pre>
<p>Ou sans le création du dossier</p>
<pre><code class="language-plaintext">type 'C:\Users\A09\OneDrive - Absys Cyborg\A09\1-INFRA_AC\A09_ID.pub' | ssh mboa@hostname 'cat &gt;&gt; .ssh/authorized_keys'</code></pre>
<p>&nbsp;</p>
<h1>Ajout de la clé privé dans un endroit sécurisé de windows : Intégrer la clé à SSH Agent</h1>
<p>ssh-add 'C:\Users\A09\Nextcloud\1-INFRA_AC\id_A09_Admin'</p>
<p>ssh-add 'C:\Users\A09\Nextcloud\1-INFRA_AC\A09_ID'</p>
<p>ssh-add 'C:\Users\mbo\Nextcloud\Documents\PERSO\TUTO_MANUEL\INFRA_HOME\SSH\mbo@LAPTOP-DKM1IBLO\id_rsa'</p>
<h1>Export clé public depuis PS pour le root : Proc complète</h1>
<p>En SSH :</p>
<p>nano /etc/ssh/sshd_config</p>
<p>Décommenter la ligne PermitRootLogin et mettre yes a la place de prohibit-password</p>
<p>systemctl restart sshd</p>
<p>En PS :</p>
<pre><code class="language-plaintext">type 'C:\Users\A09\Nextcloud\1-INFRA_AC\A09_ID.pub' | ssh root@nom_serveur_dest 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</code></pre>
<p>Ou depuis MBOHC</p>
<pre><code class="language-plaintext">type 'C:\Users\mbo\Nextcloud\Documents\PERSO\TUTO_MANUEL\INFRA_HOME\SSH\mboa@mbohc\id_rsa.pub' | ssh root@nom_serveur_dest 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</code></pre>
<p>OU depuis ASUS Zenbook</p>
<pre><code class="language-plaintext">type 'C:\Users\mbo\Nextcloud\Documents\PERSO\TUTO_MANUEL\INFRA_HOME\SSH\mbo@LAPTOP-DKM1IBLO\id_rsa.pub' | ssh root@nom_serveur_dest 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</code></pre>
<p>Tester puis</p>
<p>nano /etc/ssh/sshd_config</p>
<p>Modifier la ligne PermitRootLogin de yes à prohibit-password et Décommenter les ligne PasswordAuthentication yes et PermitEmptyPassword no</p>
<p>systemctl restart sshd</p>
<h1>Export clé public depuis PS pour le user (après avoir fait pour le root) :</h1>
<p>type 'C:\Users\A09\Nextcloud\1-INFRA_AC\id_A09_Admin.pub' | ssh user@serveur 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</p>
<p>ou</p>
<p>type 'C:\Users\mboa/.ssh/id_rsa.pub' | ssh mboa@serveur 'mkdir .ssh &amp;&amp; cat &gt;&gt; .ssh/authorized_keys'</p>
<h1>SSH-ADD Command</h1>
<p>ssh-add accepts the following command line options.</p>
<p>-c Causes a confirmation to be requested from the user every time the added identities are used for authentication. The confirmation is requested using ssh-askpass.</p>
<p>-D Deletes all identities from the agent.</p>
<p>-d Deletes the given identities from the agent. The private key files for the identities to be deleted should be listed on the command line.</p>
<p>-E Specifies the hash algorithm for displaying key fingerprints. Valid options include md5 and sha256.</p>
<p>-e pkcs11path Remove identities provided using a PKCS#11 interface, identified by the given path to its shared library. PKCS#11 interfaces are typically used for accessing keys on smartcards and hardware security modules (HSM).</p>
<p>-k When loading keys into or deleting keys from the agent, process plain private keys onmly, skipping certificates.</p>
<p>-L Lists public key parameters of all identities currently represented by the agent.</p>
<p>-l Lists fingerprints of all identities currently represented by the agent.</p>
<p>-s pkcs11path Adds identities provided by the PKCS#11 shared library at pkcs11path. This is can be used for adding keys on smartcards or in hardware security modules (HSM).</p>
<p>-t life Sets the maximum time the agent will keep the given key. After the timeout expires, the key will be automatically removed from the agent. The value is seconds, but can be suffixed for m for minutes, h for hours, d for days, or w for weeks.</p>
<p>-X Unlocks the agent. This asks for a password to unlock.</p>
<p>-x Locks the agent. This asks for a password; the password is required for unlocking the agent. When the agent is locked, it cannot be used for authentication.</p>
<h1>Pour info en cas d'erreur "bad owner" lors de connexion SSH :</h1>
<figure class="table">
  <table style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;">
    <tbody>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">Path</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.1777in;">Permission linux</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">.ssh directory (code)</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.1854in;">0700 (drwx------)</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">private keys (ex: id_rsa) (code)</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.1395in;">0600 (-rw-------)</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">config</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.1395in;">0600 (-rw-------)</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2979in;">public keys (*.pub ex: id_rsa.pub)</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.1333in;">0644 (-rw-r--r--)</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">authorized_keys (code)</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.152in;">0644 (-rw-r--r--)</td>
      </tr>
      <tr>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:2.2784in;">known_hosts</td>
        <td style="border-bottom:1pt solid #A3A3A3;border-left:1pt solid #A3A3A3;border-right:1pt solid #A3A3A3;border-top:1pt solid #A3A3A3;padding:4pt;vertical-align:top;width:1.152in;">0644 (-rw-r--r--)</td>
      </tr>
    </tbody>
  </table>
</figure>
