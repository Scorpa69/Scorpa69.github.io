<!--
title: RAZWSUS
description: 
published: true
date: 2023-12-01T13:57:19.070Z
tags: 
editor: ckeditor
dateCreated: 2023-11-28T13:43:33.227Z
-->

<h1 style="text-align:justify;">WSUS : Recr√©er la base SUSDB sur WID et les donn√©es WSUS</h1>
<p><strong>Sommaire [</strong><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#"><strong>-</strong></a><strong>]</strong></p>
<ul>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#I_Presentation">I. Pr√©sentation</a></li>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#II_Stopper_les_services_WSUS">II. Stopper les services WSUS</a></li>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#III_Sauvegarder_la_base_de_donnees_SUSDB">III. Sauvegarder la base de donn√©es SUSDB</a></li>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#IV_Supprimer_la_base_de_donnees_SUSDB">IV. Supprimer la base de donn√©es SUSDB</a></li>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#V_Supprimer_les_donnees_WSUS">V. Supprimer les donn√©es WSUS</a></li>
  <li style="text-align:justify;"><a href="https://www.it-connect.fr/wsus-recreer-la-base-susdb-sur-wid-et-les-donnees-wsus/#VI_Mise_en_route_de_WSUS">VI. Mise en route de WSUS</a></li>
</ul>
<h2 style="text-align:justify;">I. Pr√©sentation</h2>
<p style="text-align:justify;"><strong>Dans ce tutoriel, nous verrons comment repartir sur une base propre avec WSUS, sans d√©sinstaller et r√©installer le r√¥le. Uniquement en faisant une remise √† z√©ro de la base de donn√©es et des donn√©es WSUS.</strong></p>
<p style="text-align:justify;">Puisqu'une base de donn√©es WSUS qui vieillie devient moins r√©active et surtout encombre votre serveur inutilement, il peut-√™tre n√©cessaire de faire un rafraichissement radical. Bien que WSUS int√®gre un outil de nettoyage qui fonctionne plus ou moins bien, et qui parfois peut m√™me faire planter la console s'il y a trop de donn√©es √† nettoyer, on se rendra compte que ce n'est pas suffisant.</p>
<p style="text-align:justify;">Bien que √ßa peut para√Ætre effrayant au premier abord, c'est int√©ressant de repartir de z√©ro. Il y aura un travail pr√©paratoire √† refaire, notamment la premi√®re synchronisation, puis patienter le temps que vos ordinateurs remontent dans la console, mais ce rafraichissement sera forc√©ment b√©n√©fique.</p>
<p style="text-align:justify;">Voyons comment proc√©der. Dans ce tutoriel, j'utilise un serveur WSUS sous <a href="https://www.it-connect.fr/cours-tutoriels/administration-systemes/windows-server/">Windows Server</a> 2012 R2, avec une base de donn√©es <i>Windows Internal Database</i> (WID). La proc√©dure est l√©g√®rement diff√©rente si votre <a href="https://www.it-connect.fr/cours/wsus-windows-server-2022-formation-gratuite/">WSUS</a> utilise une database sur SQL Server. N√©anmoins, cette proc√©dure fonctionne sur Windows Server 2012 √† l'identique, par contre je n'ai pas test√© sur Windows Server 2016 mais je suis preneur de retour üôÇ</p>
<h2 style="text-align:justify;">II. Stopper les services WSUS</h2>
<p style="text-align:justify;">A partir d'une console <a href="https://www.it-connect.fr/cours-tutoriels/administration-systemes/scripting/powershell/">PowerShell</a> ouverte en tant qu'administrateur, stoppez les deux services li√©s √† WSUS :</p>
<pre><code class="language-plaintext">Stop-Service WSUSService , W3SVC</code></pre>
<p style="text-align:justify;">On peut v√©rifier qu'ils sont bien stopp√©s gr√¢ce √† la commande suivante :</p>
<pre><code class="language-plaintext">Get-Service WSUSService , W3SVC</code></pre>
<p style="text-align:justify;">Voyez par vous-m√™me :</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-730x166.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-730x166.png 730w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-150x34.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-550x125.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-768x174.png 768w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1-160x36.png 160w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-1.png 872w" sizes="100vw" width="730"></figure>
<h2 style="text-align:justify;">III. Sauvegarder la base de donn√©es SUSDB</h2>
<p style="text-align:justify;">Avant de supprimer la <a href="https://www.it-connect.fr/cours-tutoriels/administration-systemes/stockage/bdd/">base de donn√©es</a> SUSDB, qui est le nom de la base de donn√©es correspondante √† WSUS, nous allons effectuer une sauvegarde. Pour cela, nous allons utiliser <strong>SQL Server Management Studio </strong>qu'il faut t√©l√©charger dans la version correspondante</p>
<blockquote>
  <p><strong>Note</strong> : Si vous ne savez pas si le serveur WSUS utilise une base de donn√©es WID ou SQL Server, vous pouvez regarder la valeur "<strong>SqlServerName</strong>" dans le registre au sein de cette cl√© : <strong>HKLM\Software\Microsoft\Update Services\Server\Setup</strong></p>
</blockquote>
<p style="text-align:justify;">Logiquement sur Windows Server 2012 R2, vous devez installer le Management Studio de la version SQL Server 2012. Pour √™tre s√ªr de ce choix, acc√©dez au dossier "<strong>C:\Windows\WID\Log</strong>" et ouvrez le fichier "<strong>error.log</strong>".</p>
<p style="text-align:justify;">Comme vous pourrez le constater ci-dessous, la premi√®re ligne du fichier vous donne des indications sur la version de SQL Server 2012 (bien que la base de donn√©es soit WID). T√©l√©chargez et installez le SQL Server Studio Management ad√©quat.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-730x232.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-730x232.png 730w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-150x48.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-550x174.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-768x244.png 768w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2-160x51.png 160w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-2.png 788w" sizes="100vw" width="730"></figure>
<p style="text-align:justify;">L'installation des outils de gestion de base est suffisante :</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-730x547.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-730x547.png 730w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-150x112.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-550x412.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-768x575.png 768w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-160x120.png 160w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-106x80.png 106w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3-200x150.png 200w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-3.png 816w" sizes="100vw" width="730"></figure>
<p style="text-align:justify;">D√®s lors que l'installation est termin√©e, vous pouvez ouvrir SQL Server Management Studio en tant qu'administration (sinon √ßa ne fonctionnera pas). Indiquez comme nom de serveur la cha√Æne suivante et initiez la connexion :</p>
<p style="text-align:justify;"><strong>\\.\pipe\MICROSOFT##WID\tsql\query</strong></p>
<p style="text-align:justify;">Comme ceci :</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4.png 422w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4-150x113.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4-160x121.png 160w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4-106x80.png 106w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-4-200x150.png 200w" sizes="100vw" width="422"></figure>
<p style="text-align:justify;">Ensuite sur la gauche, d√©roulez "<i>Bases de donn√©es</i>" et sur "<i>SUSDB</i>" effectuez un clic droit puis "<i>Nouvelle requ√™te</i>" pour que l'on ex√©cute la requ√™te de backup.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-5.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-5.png 437w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-5-150x81.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-5-160x86.png 160w" sizes="100vw" width="437"></figure>
<p style="text-align:justify;">Ex√©cutez la requ√™te suivante en adaptant le chemin vers lequel vous souhaitez stocker la sauvegarde si n√©cessaire.</p>
<pre><code class="language-plaintext">backup database [susdb] to disk = 'D:\Backup\susdb.bak' with copy_only</code></pre>
<p style="text-align:justify;">Cliquez sur le bouton "<i>Ex√©cuter</i>" ensuite pour ex√©cuter la requ√™te SQL.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-6.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-6.png 595w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-6-150x32.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-6-550x116.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-6-160x34.png 160w" sizes="100vw" width="595"></figure>
<p style="text-align:justify;">Apr√®s quelques minutes, la sauvegarde doit se terminer et vous obtiendrez un message semblable √† celui-ci :</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-7.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-7.png 700w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-7-150x26.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-7-550x96.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-7-160x28.png 160w" sizes="100vw" width="700"></figure>
<h2 style="text-align:justify;">IV. Supprimer la base de donn√©es SUSDB</h2>
<p style="text-align:justify;">On poursuit notre travail par la suppression de la base de donn√©es SUSDB, toujours par l'interm√©diaire de SQL Server Management Studio. Effectuez un clic droit sur la base de donn√©es SUSDB et cliquez sur "<i>Supprimer</i>".</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-8.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-8.png 439w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-8-150x133.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-8-160x142.png 160w" sizes="100vw" width="439"></figure>
<p style="text-align:justify;">Avant de valider la suppression, cochez l'option "<i>Fermer les connexions existantes</i>" puis cliquez sur "<i>OK</i>".</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-9.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-9.png 701w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-9-150x135.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-9-550x494.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-9-160x144.png 160w" sizes="100vw" width="701"></figure>
<p style="text-align:justify;">&nbsp;</p>
<h2 style="text-align:justify;">V. Supprimer les donn√©es WSUS</h2>
<p style="text-align:justify;">Maintenant que l'on s'est d√©barrass√© de la base de donn√©es de WSUS, on va supprimer les donn√©es de WSUS. Commencez par supprimer le dossier correspondant √† ces donn√©es, g√©n√©ralement dans un dossier nomm√© "WSUS" stock√© sur un volume d√©di√© :</p>
<pre><code class="language-plaintext">Remove-Item -Path D:\WSUS\ -Recurse</code></pre>
<p style="text-align:justify;">Puis recr√©ez un r√©pertoire vide :</p>
<pre><code class="language-plaintext">Set-Location D:\
New-Item -ItemType Directory -Name "WSUS"</code></pre>
<p style="text-align:justify;">Pensez bien s√ªr √† adapter le chemin.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-10.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-10.png 670w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-10-150x40.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-10-550x148.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-10-160x43.png 160w" sizes="100vw" width="670"></figure>
<h2 style="text-align:justify;">VI. Mise en route de WSUS</h2>
<p style="text-align:justify;">Derni√®re ligne droite dans la r√©initialisation de WSUS : On va d√©marrer les deux services que l'on avait stopp√© pr√©c√©demment :</p>
<pre><code class="language-plaintext">Start-Service WSUSService , W3SVC</code></pre>
<p style="text-align:justify;">Ce qui donne :</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-11.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-11.png 670w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-11-150x34.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-11-550x123.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-11-160x36.png 160w" sizes="100vw" width="670"></figure>
<p style="text-align:justify;">Pour terminer, nous allons initialiser la cr√©ation de la base SUSDB pour finaliser la remise √† neuf. Voici la commande associ√©e :</p>
<pre><code class="language-plaintext">.\Wsusutil.exe postinstall CONTENT_DIR="D:\WSUS" SQL_INSTANCE_NAME="VDCSWSU01\WSUS"</code></pre>
<p style="text-align:justify;">Pensez √† vous positionner au pr√©alable dans le r√©pertoire o√π est stock√© Wsusutil.exe :</p>
<pre><code class="language-plaintext">Set-Location "C:\Program Files\Update Services\Tools"</code></pre>
<p style="text-align:justify;">Apr√®s quelques minutes, le processus de post-installation se termine.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-12.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-12.png 700w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-12-150x28.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-12-550x102.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-12-160x30.png 160w" sizes="100vw" width="700"></figure>
<p style="text-align:justify;">La suite consiste √† d√©marrer la console WSUS puis suivre l'assistant de configuration,&nbsp; je vous laisse en compagnie de la console WSUS que vous connaissez parfaitement et qu'il faudra reconfigurer pour repartir sur des bases saines.</p>
<figure class="image"><img src="http://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13-730x532.png" alt="" srcset="https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13-730x532.png 730w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13-150x109.png 150w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13-550x401.png 550w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13-160x117.png 160w, https://www.it-connect.fr/wp-content-itc/uploads/2017/02/wsus-reset-database-and-content-13.png 750w" sizes="100vw" width="730"></figure>
<p>&nbsp;</p>
