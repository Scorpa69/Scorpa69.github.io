<!--
title: DNS
description: 
published: true
date: 2023-09-18T12:38:05.869Z
tags: windows, commande, dns
editor: ckeditor
dateCreated: 2023-09-18T12:38:04.709Z
-->

<p>L'interface index s'obtient avec la commande :&nbsp;</p>
<p>Get-netconnectionprofile</p>
<p>&nbsp;</p>
<p>CONFIGURER LES SERVEURS DNS D'UNE MACHINE EN LOCAL:</p>
<p>Set-DnsClientServerAddress -InterfaceAlias Ethernet -ServerAddresses 10.78.50.1,127.0.0.1,10.78.50.2</p>
<p>Set-DnsClientServerAddress -InterfaceIndex 17 -ServerAddresses 192.168.1.1,192.168.1.222,10.92.50.2,10.159.50.1,10.13.50.1</p>
<p>Set-DnsClientServerAddress -InterfaceIndex 15 -ServerAddresses 10.78.50.1,10.78.50.2,10.92.50.2</p>
<p>&nbsp;</p>
<p>VOIR LES DNS D'UNE MACHINE EN LOCAL</p>
<p>Get-DnsClientServerAddress -InterfaceAlias Ethernet</p>
<p>Get-DnsClientServerAddress -InterfaceIndex 22</p>
<p>&nbsp;</p>
<p>A distance cela donne ça :</p>
<p>Invoke-Command -ComputerName VTLSADSARCADIE0 -ScriptBlock {Get-DnsClientServerAddress -InterfaceIndex 3}</p>
<p>&nbsp;</p>
<p>Invoke-Command -ComputerName VTLSADSARCADIE0 -ScriptBlock {Get-NetIPConfiguration}</p>
<p>&nbsp;</p>
<p>Invoke-Command -ComputerName VTLSADSARCADIE0 -ScriptBlock {Get-netconnectionprofile}</p>
<p>&nbsp;</p>
<p>Invoke-Command -ComputerName VIDFSAV01 -ScriptBlock {Get-netconnectionprofile}</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Invoke-Command -ComputerName VTLSADSARCADIE0, AGCE-TLSE-HPV1 -ScriptBlock {Get-netconnectionprofile}</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>CHANGER LE DNS DE PLUSIEURS MACHINE A DISTANCE AVEC UN SCRIPT :</p>
<p>&nbsp;</p>
<p>$index = (Get-netconnectionprofile).InterfaceIndex | Set-DnsClientServerAddress -InterfaceIndex $index -ServerAddresses ("10.78.50.1","10.78.50.2")</p>
<p>Set-DnsClientServerAddress -InterfaceIndex $index -ServerAddresses ("10.78.50.1","10.78.50.2")</p>
<p>&nbsp;</p>
<p>Set-DnsClientServerAddress -InterfaceIndex 5 -ServerAddresses ("10.159.50.2","10.78.50.1","10.78.50.2")</p>
<p>&nbsp;</p>
<p>Invoke-Command -computername VIDFSLX02 -SciptBlock { $Index = (getnetconnectionprofile).interfaceindex Get-DnsClientServerAddress -InterfaceIndex $index }</p>
<p>&nbsp;</p>
<p>Invoke-Command -computername VRBXDEVMES02 -SciptBlock { (Get-netconnectionprofile).InterfaceIndex }</p>
<p>&nbsp;</p>
<p>Get-DnsClientServerAddress -InterfaceIndex | $index = (Get-netconnectionprofile).InterfaceIndex</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>CHANGER LES DNS IP Fixe à DISTANCE :</p>
<p>$ListServer = Get-ADComputer -Filter '(OperatingSystem -like "Windows Server*")' -properties * | Sort-Object Name | select-object Name</p>
<p>Foreach ($server in $ListServer) { Invoke-Command -computername $Computer.Name -SciptBlock { $NewDNS = "10.78.50.1","10.78.50.2" $Adapters = Get-WmiObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DHCPEnabled -ne 'True' -and $_.DNSServerSearchOrder -ne $null} $Adapters | foreach-object {$_.setdnsserversearchorder ($NewDNS)} | out-null }}</p>
<p>&nbsp;</p>
<p>Pour DEV-AC :</p>
<p>$ListServer = Get-ADComputer -Filter '(OperatingSystem -like "Windows Server*")' -properties * | Sort-Object Name | select-object Name</p>
<p>Foreach ($server in $ListServer) { Invoke-Command -computername $Computer.Name -Command { $NewDNS = "10.78.90.2","10.78.50.2" $Adapters = Get-WmiObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DHCPEnabled -ne 'True' -and $_.DNSServerSearchOrder -ne $null} $Adapters | foreach-object {$_.setdnsserversearchorder ($NewDNS)} | out-null }}</p>
<p>a tester:</p>
<p>Invoke-Command -computername&nbsp; -Command { $NewDNS = "10.78.90.2","10.78.50.2" $Adapters = Get-WmiObject Win32_NetworkAdapterConfiguration | Where-Object {$_.DHCPEnabled -ne 'True' -and $_.DNSServerSearchOrder -ne $null} $Adapters | foreach-object {$_.setdnsserversearchorder ($NewDNS)} | out-null }</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Si OS APRES WIN8 et 2012 :</p>
<p>$ListServer = Get-ADComputer -Filter '(OperatingSystem -like "Windows Server*") -and (enabled -eq "true")' -properties * | Sort-Object Name | select-object Name</p>
<p>Foreach ($server in $ListServer) {&nbsp;</p>
<p>Invoke-Command -computername $Computer.Name -SciptBlock {</p>
<p>$Index = (get-netconnectionprofile).interfaceindex</p>
<p>Set-DnsClientServerAddress -InterfaceIndex $index -ServerAddresses ("10.78.50.1","10.78.50.2")</p>
<p>}</p>
<p>}</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;Get-DnsClientServerAddress -InterfaceIndex (get-netconnectionprofile).interfaceindex -AddressFamily IPv4</p>
<p>Get-DnsClientServerAddress -InterfaceIndex (get-netconnectionprofile).interfaceindex -AddressFamily IPv4 | select-object serveraddresses</p>
<p>&nbsp;</p>
<p>Set-DnsClientServerAddress -InterfaceIndex (get-netconnectionprofile).interfaceindex -ServerAddresses ("10.78.50.1","10.78.50.2")</p>
<p>Set-DnsClientServerAddress -InterfaceIndex (get-netconnectionprofile).interfaceindex -ServerAddresses 10.31.51.2,10.31.51.1,10.31.50.1,10.78.50.2,127.0.0.1</p>
<p>Set-DnsClientServerAddress -InterfaceIndex (get-netconnectionprofile).interfaceindex -ServerAddresses 10.78.50.2,10.78.50.1,10.92.50.2</p>
