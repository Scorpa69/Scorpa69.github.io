<!--
title: ZABBIX
description: 
published: true
date: 2023-09-18T12:40:25.455Z
tags: 
editor: ckeditor
dateCreated: 2023-09-18T12:40:24.328Z
-->

<h1>Zabbix</h1>
<ul>
  <li><a href="https://wiki.alpinelinux.org/wiki/Zabbix">Page</a></li>
  <li><a href="https://wiki.alpinelinux.org/w/index.php?title=Talk:Zabbix&amp;action=edit&amp;redlink=1">Discussion</a></li>
  <li><a href="https://wiki.alpinelinux.org/wiki/Zabbix">Read</a></li>
  <li><a href="https://wiki.alpinelinux.org/w/index.php?title=Zabbix&amp;action=edit">View source</a></li>
  <li><a href="https://wiki.alpinelinux.org/w/index.php?title=Zabbix&amp;action=history">View history</a></li>
</ul>
<p>&nbsp;</p>
<p>The purpose of this document is to assist in installing the Zabbix server software and Zabbix agent on the Alpine Linux operating system. Instructions on how to configure and use Zabbix - as well as many useful tutorials - can be found at <a href="http://www.zabbix.com">http://www.zabbix.com</a>.</p>
<p><strong>Note: </strong>The minimum required version of Alpine Linux required to install Zabbix is Alpine 2.2. this guide has been updated to zabbix 3.0</p>
<p><strong>Note: </strong>There is an alternate set of instructions here <a href="https://wiki.alpinelinux.org/wiki/Zabbix_-_cgi_and_mysql">Zabbix_-_cgi_and_mysql</a>.</p>
<h1>Install Lighttpd, and PHP</h1>
<p>For installing the additional packages first activate community packages:</p>
<p>vi /etc/apk/repositories</p>
<p>Uncomment the following:</p>
<p><a href="http://pkg.example.com/alpine/v3.11/community">http://pkg.example.com/alpine/v3.11/community</a></p>
<p>Update the packagelist:</p>
<p>apk update</p>
<p>Install the additional packages:</p>
<p>apk add lighttpd php7-common php7-session php7-iconv php7-json php7-gd php7-curl php7-xml php7-mysqli php7-imap php7-cgi fcgi php7-pdo php7-pdo_mysql php7-soap php7-xmlrpc php7-posix php7-mcrypt php7-gettext php7-ldap php7-ctype php7-dom php7-simplexml</p>
<h2>Configure Lighttpd</h2>
<p><strong>Edit lighttpd.conf</strong></p>
<p>vi /etc/lighttpd/lighttpd.conf</p>
<p>Uncomment line:</p>
<p>include "mod_fastcgi.conf"
</p>
<h2>Start lighttpd service and add to needed runlevel</h2>
<p>rc-service lighttpd start &amp;&amp; rc-update add lighttpd default</p>
<p>For Zabbix you will have to install following two extra packages otherwise Zabbix will not run. 1. php7-mbstring 2. php7-pgsql</p>
<p>To Install these two packages</p>
<p>apk add php7-mbstring php7-pgsql</p>
<h1>Configure PostgreSQL</h1>
<p>Install PostgreSQL</p>
<p>apk add postgresql postgresql-client</p>
<p>Now configure PostgreSQL:</p>
<p>/etc/init.d/postgresql setup /etc/init.d/postgresql start rc-update add postgresql</p>
<h1>Install Zabbix</h1>
<p>apk add zabbix zabbix-pgsql zabbix-webif zabbix-setup</p>
<p>Now we need to set up the zabbix database. Substitute '*********' in the example below for a real password:</p>
<p>psql -U postgres postgres=# create user zabbix with password '*********'; postgres=# create database zabbix owner zabbix; postgres=# \q cd /usr/share/zabbix/database/postgresql cat schema.sql | psql -U zabbix zabbix cat images.sql | psql -U zabbix zabbix cat data.sql | psql -U zabbix zabbix</p>
<p>Create a softlink for the Zabbix web-frontend files:</p>
<p>rm /var/www/localhost/htdocs -R ln -s /usr/share/webapps/zabbix /var/www/localhost/htdocs</p>
<p>Edit PHP configuration to satisfy some zabbix requirements. Edit /etc/php7/php.ini and configure the following values at least:</p>
<p>Max_execution_time = 600
  Expose_php = Off
  Date.timezone = &lt;insert your timezone here&gt;
  post_max_size = 32M
  upload_max_filesize = 16M
  max_input_time = 600
  memory_limit = 256M
</p>
<p>Also comment (doc_root &amp; user_dir ) by putting # before these.</p>
<p>Configure the following entries in /etc/zabbix/zabbix_server.conf, where DBPassword is the password chosen for the database above:</p>
<p>DBName=zabbix

  # Database user

  DBUser=zabbix

  # Database password
  # Comment this line if no password used

  DBPassword=*********

  FpingLocation=/usr/sbin/fping
</p>
<p>Start Zabbix server:</p>
<p>rc-update add zabbix-server /etc/init.d/zabbix-server start</p>
<p>Fix permissions on conf directory.</p>
<p>chown -R lighttpd /usr/share/webapps/zabbix/conf</p>
<p>You should now be able to browse to the Zabbix frontend: http://yourservername/.</p>
<p>or</p>
<p>You should now be able to browse to the Zabbix setup frontend: http://yourserverip/instal.php.</p>
<p>Follow the setup instructions to configure Zabbix, supplying the database information used above.</p>
<p>After setup, login using: Login name: <strong>Admin</strong> Password:<strong>zabbix</strong>. (as described at <a href="http://www.zabbix.com/documentation/1.8/manual/installation">http://www.zabbix.com/documentation/1.8/manual/installation</a>)</p>
<p>Finally, Zabbix requires special permissions to use the fping binary.</p>
<p>chmod u+s /usr/sbin/fping</p>
<h1>Install Zabbix Agent on Monitored Servers</h1>
<p>Zabbix can monitor almost any operating system, including Alpine Linux hosts. Complete the following steps to install the Zabbix agent on Alpine Linux.</p>
<p><strong>Note: </strong>Support to allow zabbix-agentd to view running processes on Alpine Linux has been added since linux-grsec-2.6.35.9-r2. Please ensure you have that kernel installed prior to attempting to run zabbix-agentd.</p>
<p>Ensure that the readproc group exists (support added since alpine-baselayout-2.0_rc1-r1), by adding the following line to /etc/group:</p>
<p>readproc:x:30:zabbix</p>
<p>Install the agent package:</p>
<p>apk add zabbix-agent</p>
<p>Edit the /etc/zabbix/zabbix_agentd.conf file and configure at least the following option:</p>
<p>Server=&lt;ip or hostname of zabbix server&gt;
  Hostname=&lt;ip or hostname of zabbix agent&gt;
  ListenPort=10050
</p>
<p>Start the zabbix-agent:</p>
<p>rc-update add zabbix-agentd /etc/init.d/zabbix-agentd start</p>
<p>In case you want to monitor using SNMP agent on remote machines you have to add these packages on zabbix server:</p>
<p>apk add net-snmp net-snmp-tools</p>
<p>And add these packages on remote machines:</p>
<p>apk add net-snmp</p>
<p><br>&nbsp;</p>
<h1>Optional: Crash course in adding hosts, checks, and notifications</h1>
<p><i>Note:</i> This is optional since it's not specific to Alpine Linux, but I wanted a couple notes for how to perform a simple check on a server that doesn't have the agent installed on it, and be notified on state changes.</p>
<p>Administration -&gt; Media Types -&gt; Email</p>
<ul>
  <li>Setup server, helo, email from address</li>
</ul>
<p>Administration -&gt; Users</p>
<ul>
  <li>Setup each user who'll get notified, make sure they have media type "Email" added with their address</li>
</ul>
<p>Configuration -&gt; Hosts -&gt; Create host</p>
<ul>
  <li>In Linux Servers hostgroup</li>
  <li>Define dns name, ip, connect by IP</li>
  <li>If the machine is a simple networking device that will only be monitored using SNMP, add it to Template_SNMPv2_Device, and you're done.</li>
</ul>
<p>Configuration -&gt; Templates -&gt; Create template</p>
<ul>
  <li>Give it a name (Template_Alpine_Linux_Infra_HTTP)</li>
  <li>In Templates group</li>
</ul>
<p>Configuration -&gt; Templates -&gt; Template_Alpine_Linux_Infra_HTTP -&gt; Items</p>
<ul>
  <li>Create Item</li>
  <li>Host: Template_Alpine_Linux_Infra_HTTP</li>
  <li>Description: HTTP Basic Check</li>
  <li>Type: Simple_check</li>
  <li>Key: http,80</li>
</ul>
<p>Configuration -&gt; Templates -&gt; Template_Alpine_Linux_Infra_HTTP -&gt; Triggers</p>
<ul>
  <li>Create Trigger</li>
  <li>Name: "HTTP Trigger"</li>
  <li>Expression: {Template_Alpine_Linux_Infra_HTTP:http,80.last(0)}#1</li>
  <li>Severity: High</li>
</ul>
<p>Configuration -&gt; Actions -&gt;</p>
<ul>
  <li>Create Action</li>
  <li>name: Email notifications</li>
  <li>Event source: triggers</li>
  <li>Default Subject: add "{HOST.DNS}:" to the beginning</li>
  <li>Default message: add "{HOST.DNS}:" to the beginning</li>
  <li>Conditions: make host have to be from "Linux Servers" hostgroup, and Template_Alpine_Linux_Infra_HTTP:HTTP trigger" is not 1</li>
  <li>Email affected users</li>
</ul>
