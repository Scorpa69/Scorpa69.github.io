<!--
title: K3S
description: 
published: true
date: 2023-09-18T12:40:33.685Z
tags: 
editor: ckeditor
dateCreated: 2023-09-18T12:40:32.580Z
-->

<h1>Procédure déploiement d’un serveur k3s sur debian</h1>
<p>D'accord, voici les étapes pour déployer un cluster Kubernetes monocœur avec K3s et un tableau de bord fonctionnel :</p>
<p>Tout d'abord, installez les prérequis suivants sur votre serveur :</p>
<ul>
  <li>Docker</li>
  <li>curl</li>
</ul>
<p>Téléchargez et installez K3s en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">curl -sfL https://get.k3s.io | sh -
</code></pre>
<p>Cette commande télécharge et installe la dernière version de K3s sur votre système. Le processus d'installation devrait prendre quelques minutes.</p>
<p>Vérifiez que K3s est en cours d'exécution en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">sudo systemctl status k3s
</code></pre>
<p>Vous devriez voir le statut de K3s, ainsi que des informations sur le nœud Kubernetes monocœur.</p>
<p>Installez le tableau de bord Kubernetes en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.4.1/aio/deploy/recommended.yaml
</code></pre>
<p>Cette commande utilise <code>kubectl</code> pour déployer le tableau de bord Kubernetes à partir du manifeste recommandé.</p>
<p>Démarrez un proxy Kubernetes en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">kubectl proxy
</code></pre>
<p>Cette commande démarre un proxy qui vous permet d'accéder au tableau de bord Kubernetes via un navigateur web.</p>
<p>Accédez au tableau de bord Kubernetes en ouvrant un navigateur web et en accédant à l'URL suivante :</p>
<pre><code class="language-plaintext">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre>
<p>Vous devriez voir le tableau de bord Kubernetes, qui vous permet de visualiser et de gérer votre cluster Kubernetes.</p>
<h2>Création d'un admin pour accès distant</h2>
<p>Create an admin user for the Kubernetes dashboard by creating a file named <code>dashboard-adminuser.yaml</code> with the following contents:</p>
<pre><code class="language-plaintext">apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin-user
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: admin-user
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: admin-user
  namespace: kubernetes-dashboard
</code></pre>
<p>This will create a service account named <code>admin-user</code> in the <code>kubernetes-dashboard</code> namespace and grant it the <code>cluster-admin</code> role, which will give you full access to the Kubernetes dashboard.</p>
<p>Apply the YAML manifest by running the following command:</p>
<pre><code class="language-plaintext">kubectl apply -f dashboard-adminuser.yaml
</code></pre>
<p>Retrieve the authentication token for the <code>admin-user</code> service account by running the following command:</p>
<pre><code class="language-plaintext">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')
</code></pre>
<p>This will output a long string of letters and numbers. Copy this string to your clipboard.</p>
<p>Start a proxy to the Kubernetes API server by running the following command:</p>
<pre><code class="language-plaintext">kubectl proxy
</code></pre>
<p>This will start a proxy on your local machine that allows you to access the Kubernetes API server.</p>
<p>Open a web browser and navigate to the following URL:</p>
<pre><code class="language-plaintext">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre>
<p>This will open the Kubernetes dashboard in your web browser.</p>
<p>Click the "Token" tab and paste the authentication token you copied earlier into the "Enter token" field. Click the "Sign in" button to log in to the dashboard.</p>
<h1>Install de Rancher CLI :</h1>
<p>D'accord, voici les étapes à suivre pour installer le client Rancher CLI sur une distribution Debian en utilisant les instructions officielles de Rancher :</p>
<p>Tout d'abord, assurez-vous d'avoir les prérequis suivants installés sur votre système :</p>
<pre><code class="language-plaintext">apt install apt-transport-https ca-certificates gnupg-agent software-properties-common -y</code></pre>
<p>Ajoutez la clé GPG de Rancher en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">curl -fsSL https://releases.rancher.com/cli2/v2.4.11/rancher-linux-amd64-v2.4.11.tar.gz.asc | apt-key add -
</code></pre>
<p>Cette commande ajoute la clé GPG de Rancher à votre trousseau de clés.</p>
<p>Ajoutez le dépôt Rancher à votre liste de sources APT en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">echo "deb https://releases.rancher.com/cli2/v2.4.11/debian-amd64 /" | tee /etc/apt/sources.list.d/rancher-cli.list
</code></pre>
<p>Cette commande ajoute le dépôt Rancher à votre liste de sources APT.</p>
<p>Mettez à jour votre liste de paquets en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">apt-get update
</code></pre>
<p>Cette commande actualise la liste des paquets disponibles dans les sources APT, y compris le nouveau dépôt Rancher.</p>
<p>Installez le client Rancher CLI en exécutant la commande suivante :</p>
<pre><code class="language-plaintext">apt-get install rancher-cli=2.4.11
</code></pre>
<p>Cette commande installe la version 2.4.11 du client Rancher CLI sur votre système.</p>
<p>Vérifiez que l'installation a réussi en exécutant la commande <code>rancher --version</code>. Vous devriez voir quelque chose comme ceci :</p>
<pre><code class="language-plaintext">rancher version v2.4.11
</code></pre>
<p>Cela indique que le client Rancher CLI est installé et prêt à être utilisé.</p>
<p>Et voilà, vous avez installé avec succès le client Rancher CLI sur votre système Debian en utilisant les instructions officielles de Rancher !</p>
<h1>Autre procédure :</h1>
<p><strong>Step 1: Install K3s</strong></p>
<p>SSH into your server (replace <code>your_server_ip</code> with your actual server IP address):</p>
<pre><code class="language-plaintext">ssh your_user@your_server_ip
</code></pre>
<p>Download and run the K3s installation script:</p>
<pre><code class="language-plaintext">curl -sfL https://get.k3s.io | sh -
</code></pre>
<p>Verify that K3s is running:</p>
<pre><code class="language-plaintext">sudo k3s kubectl get nodes
</code></pre>
<p><strong>Step 2: Set up </strong><code><strong>kubectl</strong></code><strong> on your local machine</strong></p>
<p>Install <code>kubectl</code> on your local machine if you haven't already. You can follow the [official Kubernetes documentation](<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a>) for installation instructions.</p>
<p>Copy the K3s kubeconfig file from the server to your local machine:</p>
<pre><code class="language-plaintext">scp your_user@your_server_ip:/etc/rancher/k3s/k3s.yaml ~/.kube/config
</code></pre>
<p>Replace the <code>server</code> value in the kubeconfig file with your server's IP address:</p>
<pre><code class="language-plaintext">sed -i "s/127.0.0.1/your_server_ip/g" ~/.kube/config
</code></pre>
<p>Verify that you can access the cluster:</p>
<pre><code class="language-plaintext">kubectl get nodes
</code></pre>
<p><strong>Step 3: Deploy the Kubernetes Dashboard</strong></p>
<p>Apply the dashboard manifest:</p>
<pre><code class="language-plaintext">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml
</code></pre>
<p>Create a service account and cluster role binding for the dashboard:</p>
<pre><code class="language-plaintext">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: v1
kind: ServiceAccount
metadata:
  name: dashboard-admin
  namespace: kubernetes-dashboard
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: dashboard-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: dashboard-admin
  namespace: kubernetes-dashboard
EOF
</code></pre>
<p>Retrieve the token for the dashboard service account:</p>
<pre><code class="language-plaintext">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep dashboard-admin | awk '{print $1}')
</code></pre>
<p>Copy the <code>token</code> value. You will use this to log in to the dashboard.</p>
<p><strong>Step 4: Access the Dashboard</strong></p>
<p>Run a <code>kubectl</code> proxy on your local machine:</p>
<pre><code class="language-plaintext">kubectl proxy
</code></pre>
<p>Access the dashboard by opening a browser and navigating to:</p>
<pre><code class="language-plaintext">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre>
<p>Select "Token" as the authentication method and paste the token you copied earlier.</p>
